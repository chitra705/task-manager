<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>payslip</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag 'payslip', media: 'all', 'data-turbolinks-track': 'reload' %>

</head>
<body>
  <h4><b>PAYSLIP</b></h4>
  <div class="payslip_div">

    <%= form_with model: @payslip, url: payslips_path, method: :post do |form| %>
  <div>
    <%= form.label :pay_period %>
    <%= form.text_field :pay_period %>
  </div>

  <div>
    <%= form.label :worked_days %>
    <%= form.number_field :worked_days %>
  </div>

  <div>
    <%= form.label :designation %>
    <%= form.text_field :designation %>
  </div>

  <div>
    <%= form.label :department %>
    <%= form.text_field :department %>
  </div>

  <table class="table table-striped table-bordered mt-5">
    <thead class="thead-dark">
      <tr>
        <th><%= form.label :earnings %></th>
        <th><%= form.label :earning_amount %></th>
        <th><%= form.label :deductions %></th>
        <th><%= form.label :deduction_amount %></th>
      </tr>
    </thead>
    <tbody>
      <%= form.fields_for :payslip_values do |payslip_form| %>
        <tr>
    <td><%= payslip_form.text_field :earnings, name: "sal_payslip[payslip_values][][earnings]", class: 'form-control' %></td>
    <td><%= payslip_form.number_field :earning_amount, name: "sal_payslip[payslip_values][][earning_amount]", class: 'form-control' %></td>
    <td><%= payslip_form.text_field :deductions, name: "sal_payslip[payslip_values][][deductions]", class: 'form-control' %></td>
    <td><%= payslip_form.number_field :deduction_amount, name: "sal_payslip[payslip_values][][deduction_amount]", class: 'form-control' %></td>
  </tr>
      <% end %>
    </tbody>
  </table>


  <div class="mt-3">
    <button type="button" id="add-row" class="btn btn-secondary">Add Row</button>
  </div>

  <div>
    <%= form.submit "Create Payslip" %>
  </div>
<% end %>

  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const addRowButton = document.getElementById('add-row');
      const tableBody = document.querySelector('tbody');

      addRowButton.addEventListener('click', function () {
        const lastRow = tableBody.querySelector('tr:last-child');
        const newRow = lastRow.cloneNode(true);

        newRow.querySelectorAll('input').forEach(input => {
          input.value = ''; // Clear the values for the new row

          const name = input.getAttribute('name');
          if (name) {
            // Update the name attribute to reflect the array index
            const newName = name.replace(/\[(\d+)\]/, (match, index) => `[${parseInt(index, 10) + 1}]`);
            input.setAttribute('name', newName);
          }
        });

        tableBody.appendChild(newRow);
      });
    });



  </script>

</body>
</html>